{% extends 'news/base_generic.html' %}

{% block content %}
<h2>News Stories</h2>

<div>
    <form method="get">
        <label for="category">Filter by Category:</label>
        <select id="category" name="category" onchange="this.form.submit()">
            <option value="">All Categories</option>
            {% for category in categories %}
            <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
            {% endfor %}
        </select>
        
        <label for="sort_by">Sort by:</label>
        <select id="sort_by" name="sort_by" onchange="this.form.submit()">
            <option value="time" {% if request.GET.sort_by == 'time' %}selected{% endif %}>Time</option>
            <option value="popularity" {% if request.GET.sort_by == 'popularity' %}selected{% endif %}>Popularity</option>
            <option value="category" {% if request.GET.sort_by == 'category' %}selected{% endif %}>Category</option>
        </select>
    </form>
</div>

<ul class="post-list">
    {% for post in posts %}
    <li>
        <a href="{% url 'post_detail' post.slug %}">{{ post.title }}</a>
        <p>{{ post.content|truncatewords:30|safe }}</p>
        <p>Category: {{ post.category.name }}</p>
        <p>Author: {{ post.author.username }}</p>
        <p>Posted on: {{ post.created_at }}</p>
    </li>
    {% endfor %}
</ul>
{% endblock %}
